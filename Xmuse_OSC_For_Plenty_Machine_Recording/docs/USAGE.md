# 操作说明

## 基本操作

### 1. 启动程序

基本启动（使用默认端口 8001 和 8002）：
```bash
python run.py
```

自定义端口启动：
```bash
python run.py --ports 8001 8002 8003
```

启用调试模式：
```bash
python run.py --debug
```

### 2. 命令行参数

| 参数 | 说明 | 默认值 | 示例 |
|------|------|--------|------|
| `--ports` | OSC 服务器端口列表 | 8001 8002 | `--ports 8001 8002 8003` |
| `--save-dir` | 数据保存目录 | data | `--save-dir data/session1` |
| `--debug` | 启用调试模式 | False | `--debug` |
| `--all-signals` | 接收所有信号 | False | `--all-signals` |

### 3. 信号选择界面

如果不使用 `--all-signals` 参数，程序会显示交互式信号选择界面：

```
╔════════════════════╗
║  OSC 信号选择器   ║
╚════════════════════╝

可用信号类型：
┌──────────────────┐
║ EEG 信号         ║
├──────────────────┤
[1] /eeg → 脑电信号
[2] /is_good → 信号质量指标
└──────────────────┘

┌──────────────────┐
║ 生理信号         ║
├──────────────────┤
[3] /ppg → 光电容积信号
[4] /batt → 电池电量
[5] /drlref → 参考电极信号
└──────────────────┘

┌──────────────────┐
║ 运动数据         ║
├──────────────────┤
[6] /acc → 加速度数据
[7] /gyro → 陀螺仪数据
└──────────────────┘

操作指南：
• 输入序号选择信号（多个序号用空格分隔）
• 直接回车选择所有信号
• 输入 'q' 退出程序
• 输入 'h' 显示帮助信息

请选择 >
```

### 4. 数据保存

数据以 CSV 格式保存在指定目录下，文件命名格式：
```
osc_data_port_{端口号}_{时间戳}.csv
```

示例：`osc_data_port_8001_20240120_101523.csv`

CSV 文件格式：
```csv
Timestamp,Address,Data
2024-01-20 10:15:23.456,/8001/eeg,"(123.45, 234.56, 345.67)"
2024-01-20 10:15:23.458,/8001/ppg,"(98.76, 87.65)"
```

### 5. 日志记录

日志文件：`osc_receiver.log`
- 调试模式：记录 DEBUG 级别及以上的日志
- 普通模式：记录 INFO 级别及以上的日志

## 监控和性能

### 1. 实时性能统计
程序会自动记录以下性能指标：
- 数据接收速率（条/秒）
- 数据丢弃速率（条/秒）
- 缓冲区使用率（%）

### 2. 端口状态监控
程序会定期检查并报告每个端口的状态：
- 连接正常
- 连接异常

### 3. 性能优化建议
- 系统内存：建议 4GB 以上
- 存储设备：推荐使用 SSD
- 网络环境：确保稳定连接
- 端口数量：根据实际需求选择
- 信号选择：只接收必要的信号类型

## 故障处理

### 1. 启动问题
- 端口被占用：
  ```bash
  # 检查端口占用（Linux/MacOS）
  netstat -an | grep 8001
  lsof -i :8001
  
  # 检查端口占用（Windows）
  netstat -ano | findstr 8001
  ```
- 权限问题：确保有足够的系统权限

### 2. 运行时问题
- 数据存储：检查目录权限和磁盘空间
- 性能下降：监控系统资源使用情况
- 连接异常：检查网络状态

### 3. 异常处理
- 使用 --debug 模式获取详细日志
- 程序会自动处理常见异常
- 使用 Ctrl+C 可以安全退出

## 最佳实践

### 1. 启动前准备
- 检查端口占用情况
- 验证存储目录权限
- 确保系统资源充足

### 2. 运行时监控
- 观察性能统计信息
- 监控日志输出
- 检查数据文件增长

### 3. 安全退出
- 使用 Ctrl+C 正常退出
- 等待数据完全保存
- 确认资源正确释放

## 使用示例

1. 基本使用：
```bash
python run.py
```

2. 指定多个端口：
```bash
python run.py --ports 8001 8002 8003
```

3. 自定义保存目录并启用调试：
```bash
python run.py --save-dir data/session1 --debug
```

4. 接收所有信号：
```bash
python run.py --all-signals
```

## 性能优化建议

### 1. 系统资源
- 确保足够的系统内存（建议 4GB 以上）
- 使用 SSD 存储设备可提高写入性能
- 保持充足的磁盘空间

### 2. 网络设置
- 确保网络连接稳定
- 避免高延迟网络环境
- 减少网络拥塞

### 3. 程序配置
- 根据实际需求选择合适的端口数量
- 只接收必要的信号类型
- 定期检查性能统计信息

## 故障排除

### 1. 常见问题
- 如果程序无法启动，检查端口占用
- 如果数据保存失败，检查目录权限
- 如果性能下降，检查系统资源使用情况

### 2. 日志分析
- 查看 osc_receiver.log 文件
- 使用 --debug 模式获取详细信息
- 分析性能统计数据

### 3. 异常处理
- 程序会自动处理大多数异常情况
- 使用 Ctrl+C 可以安全退出
- 确保正确关闭以保存所有数据 